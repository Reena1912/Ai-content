<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Repurpose</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0e0e0e;
    --surface: #161616;
    --border: #2a2a2a;
    --text: #e8e8e8;
    --muted: #666;
    --accent: #c8f564;
    --font-mono: 'DM Mono', monospace;
    --font-sans: 'DM Sans', sans-serif;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-sans);
    min-height: 100vh;
    display: grid;
    grid-template-rows: auto 1fr;
  }

  header {
    padding: 2rem 3rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: baseline;
    gap: 1rem;
  }

  header h1 {
    font-family: var(--font-mono);
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    color: var(--accent);
  }

  header span {
    font-size: 0.75rem;
    color: var(--muted);
    font-family: var(--font-mono);
  }

  main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    height: calc(100vh - 65px);
  }

  .panel {
    padding: 2rem 3rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .panel-left {
    border-right: 1px solid var(--border);
  }

  label {
    font-size: 0.7rem;
    font-family: var(--font-mono);
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  textarea {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--font-sans);
    font-size: 0.875rem;
    line-height: 1.6;
    padding: 1rem;
    resize: none;
    outline: none;
    border-radius: 4px;
    transition: border-color 0.2s;
  }

  textarea:focus { border-color: #444; }
  textarea::placeholder { color: var(--muted); }

  .platform-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.5rem;
  }

  .platform-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.7rem;
    padding: 0.5rem 0.25rem;
    cursor: pointer;
    border-radius: 3px;
    transition: all 0.15s;
    letter-spacing: 0.05em;
  }

  .platform-btn:hover { border-color: #444; color: var(--text); }

  .platform-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(200, 245, 100, 0.05);
  }

  .submit-btn {
    background: var(--accent);
    border: none;
    color: #0e0e0e;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: 500;
    padding: 0.8rem 1.5rem;
    cursor: pointer;
    border-radius: 3px;
    letter-spacing: 0.08em;
    transition: opacity 0.15s, transform 0.1s;
    align-self: flex-start;
  }

  .submit-btn:hover { opacity: 0.9; }
  .submit-btn:active { transform: scale(0.98); }
  .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .output-area {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1rem;
    overflow-y: auto;
    font-size: 0.875rem;
    line-height: 1.7;
    color: var(--text);
    white-space: pre-wrap;
    font-family: var(--font-sans);
  }

  .output-area.empty {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.75rem;
  }

  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.75rem;
  }

  .dot {
    width: 4px; height: 4px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 1.2s ease-in-out infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes pulse {
    0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1); }
  }

  .error { color: #ff6b6b; font-family: var(--font-mono); font-size: 0.8rem; }

  .copy-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 0.7rem;
    padding: 0.4rem 0.75rem;
    cursor: pointer;
    border-radius: 3px;
    transition: all 0.15s;
    align-self: flex-end;
  }
  .copy-btn:hover { border-color: #444; color: var(--text); }
  .copy-btn.copied { border-color: var(--accent); color: var(--accent); }

  @media (max-width: 768px) {
    main { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; height: auto; }
    .panel-left { border-right: none; border-bottom: 1px solid var(--border); }
    header { padding: 1.25rem 1.5rem; }
    .panel { padding: 1.5rem; }
    .platform-grid { grid-template-columns: repeat(3, 1fr); }
  }
</style>
</head>
<body>

<header>
  <h1>repurpose_</h1>
  <span>content transformation tool</span>
</header>

<main>
  <div class="panel panel-left">
    <label>Article / Source</label>
    <textarea id="article" placeholder="Paste your article or content here..."></textarea>

    <div>
      <label style="display:block;margin-bottom:0.75rem;">Platform</label>
      <div class="platform-grid">
        <button class="platform-btn active" data-platform="twitter">Twitter</button>
        <button class="platform-btn" data-platform="linkedin">LinkedIn</button>
        <button class="platform-btn" data-platform="instagram">Instagram</button>
        <button class="platform-btn" data-platform="newsletter">Newsletter</button>
        <button class="platform-btn" data-platform="medium">Medium</button>
      </div>
    </div>

    <button class="submit-btn" id="submitBtn">â†’ REPURPOSE</button>
  </div>

  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <label>Output</label>
      <button class="copy-btn" id="copyBtn" style="display:none;">copy</button>
    </div>
    <div class="output-area empty" id="output">awaiting input</div>
  </div>
</main>

<script>
  const API_URL = 'http://localhost:8000';
  let selectedPlatform = 'twitter';
  let outputContent = '';

  // Platform selection
  document.querySelectorAll('.platform-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedPlatform = btn.dataset.platform;
    });
  });

  // Submit
  document.getElementById('submitBtn').addEventListener('click', async () => {
    const article = document.getElementById('article').value.trim();
    if (!article) return;

    const output = document.getElementById('output');
    const btn = document.getElementById('submitBtn');
    const copyBtn = document.getElementById('copyBtn');

    btn.disabled = true;
    copyBtn.style.display = 'none';
    output.className = 'output-area';
    output.innerHTML = `<div class="loading"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

    try {
      const res = await fetch(`${API_URL}/repurpose`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ article, platform: selectedPlatform })
      });

      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.detail || `HTTP ${res.status}`);
      }

      const data = await res.json();
      outputContent = data.repurposed_content;
      output.className = 'output-area';
      output.textContent = outputContent;
      copyBtn.style.display = 'block';

    } catch (err) {
      output.className = 'output-area';
      output.innerHTML = `<span class="error">Error: ${err.message}</span>`;
    } finally {
      btn.disabled = false;
    }
  });

  // Copy
  document.getElementById('copyBtn').addEventListener('click', function() {
    navigator.clipboard.writeText(outputContent).then(() => {
      this.textContent = 'copied!';
      this.classList.add('copied');
      setTimeout(() => {
        this.textContent = 'copy';
        this.classList.remove('copied');
      }, 1500);
    });
  });

  // Ctrl+Enter shortcut
  document.getElementById('article').addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
      document.getElementById('submitBtn').click();
    }
  });
</script>
</body>
</html>